<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üê± Tamagotchi de los Gatos</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        const SOUND_LIBRARY = {
          meow: {
            files: ['meow-1.mp3', 'meow_QO6VsE6.mp3', 'the-end-meow-by-nekocat-just-3-second-1.mp3'],
            volume: 0.6
          },
          purr: {
            files: ['cat-purr.mp3', 'little-puff-purr.mp3', 'little-puff-purr-brr.mp3'],
            volume: 0.45
          }
        };

        const ACTION_SOUNDS = {
          feed: ['meow', 'purr'],
          play: ['meow'],
          sleep: ['purr']
        };

        const clamp = (value, min, max) => Math.min(Math.max(value, min), max);

        const createSoundController = () => {
          if (typeof Audio === 'undefined') {
            return null;
          }

          const pools = Object.entries(SOUND_LIBRARY).reduce((acc, [key, definition]) => {
            const { files = [], volume = 0.5 } = definition || {};
            const entries = files.filter(Boolean).map(src => {
              const element = new Audio(src);
              element.preload = 'auto';
              element.volume = volume;
              return { src, instances: [element], volume };
            });
            if (entries.length > 0) {
              acc[key] = entries;
            }
            return acc;
          }, {});

          const getInstance = (entry) => {
            if (!entry) return null;
            const available = entry.instances.find(audio => audio.paused);
            if (available) {
              return available;
            }
            const clone = entry.instances[0]?.cloneNode(true) || new Audio(entry.src);
            clone.volume = entry.volume;
            clone.preload = 'auto';
            entry.instances.push(clone);
            return clone;
          };

          const playEffect = (effectKey) => {
            const entries = pools[effectKey];
            if (!entries || entries.length === 0) return;
            const entry = entries[Math.floor(Math.random() * entries.length)];
            const audio = getInstance(entry);
            if (!audio) return;
            audio.currentTime = 0;
            const playback = audio.play();
            if (playback && typeof playback.catch === 'function') {
              playback.catch(() => {});
            }
          };

          const playForAction = (actionKey) => {
            const effects = ACTION_SOUNDS[actionKey];
            if (Array.isArray(effects) && effects.length > 0) {
              effects.forEach(effect => playEffect(effect));
            } else {
              playEffect(actionKey);
            }
          };

          return {
            playEffect,
            playForAction
          };
        };

        const CatTamagotchi = () => {
          const [gameState, setGameState] = useState({
            happiness: 75,
            energy: 60,
            hunger: 40,
            mood: 'content',
            lastInteraction: Date.now()
          });

          const [cats, setCats] = useState([
            {
              name: 'Lukis',
              type: 'tuxedo',
              position: { x: 25, y: 60 },
              direction: 1,
              actionState: 'idle',
              tilt: 0,
              bobOffset: 0
            },
            {
              name: 'Arwen',
              type: 'gris',
              position: { x: 50, y: 70 },
              direction: -1,
              actionState: 'idle',
              tilt: 0,
              bobOffset: 0
            },
            {
              name: 'Iria',
              type: 'siamese',
              position: { x: 75, y: 65 },
              direction: 1,
              actionState: 'idle',
              tilt: 0,
              bobOffset: 0
            }
          ]);

          const [isAnimating, setIsAnimating] = useState(false);
          const [currentAction, setCurrentAction] = useState('');
          const [isNightTime, setIsNightTime] = useState(false);
          const soundControllerRef = useRef(typeof window !== 'undefined' ? createSoundController() : null);

          const playActionSound = useCallback((actionKey) => {
            const controller = soundControllerRef.current;
            if (!controller) return;
            controller.playForAction(actionKey);
          }, []);

          useEffect(() => {
            const updateTimeOfDay = () => {
              const hour = new Date().getHours();
              setIsNightTime(hour < 6 || hour >= 20);
            };
            updateTimeOfDay();
            const timeInterval = setInterval(updateTimeOfDay, 60000);
            return () => clearInterval(timeInterval);
          }, []);

          useEffect(() => {
            const moveInterval = setInterval(() => {
              if (gameState.mood === 'tired' || isAnimating) return;
              setCats(prevCats =>
                prevCats.map(cat => {
                  let newX = cat.position.x + (cat.direction * (Math.random() * 3 + 1.5));
                  let newDirection = cat.direction;
                  if (newX <= 12) {
                    newX = 12;
                    newDirection = 1;
                  } else if (newX >= 88) {
                    newX = 88;
                    newDirection = -1;
                  }
                  if (Math.random() < 0.25) {
                    newDirection *= -1;
                  }
                  const newY = clamp(cat.position.y + (Math.random() - 0.5) * 3, 55, 78);
                  const tilt = clamp((Math.random() - 0.5) * 12, -8, 8);
                  const bobOffset = clamp((Math.random() - 0.5) * 8, -4, 4);
                  return {
                    ...cat,
                    position: { x: newX, y: newY },
                    direction: newDirection,
                    tilt,
                    bobOffset
                  };
                })
              );
            }, 2000);
            return () => clearInterval(moveInterval);
          }, [gameState.mood, isAnimating]);

          useEffect(() => {
            const interval = setInterval(() => {
              setGameState(prevState => {
                const newHunger = Math.max(0, prevState.hunger - 5);
                const newEnergy = Math.max(0, prevState.energy - 5);
                const newHappiness = Math.max(0, prevState.happiness - 5);
                let mood = 'content';
                if (newHappiness > 70 && newEnergy > 70 && newHunger > 70) mood = 'happy';
                else if (newHappiness > 50 && newEnergy > 50 && newHunger > 50) mood = 'content';
                else if (newHunger < 30) mood = 'hungry';
                else if (newEnergy < 30) mood = 'tired';
                else if (newHappiness < 30) mood = 'sad';
                return {
                  ...prevState,
                  hunger: newHunger,
                  energy: newEnergy,
                  happiness: newHappiness,
                  mood
                };
              });
            }, 3000);
            return () => clearInterval(interval);
          }, []);

          const handleAction = (action) => {
            if (isAnimating) return;
            setIsAnimating(true);
            setCurrentAction(action);
            playActionSound(action);
            setCats(prevCats =>
              prevCats.map(cat => ({
                ...cat,
                actionState: action
              }))
            );
            setTimeout(() => {
              setGameState(prevState => {
                let newState = { ...prevState, lastInteraction: Date.now() };
                switch (action) {
                  case 'feed':
                    newState.hunger = Math.min(100, prevState.hunger + 30);
                    newState.happiness = Math.min(100, prevState.happiness + 15);
                    break;
                  case 'play':
                    newState.energy = Math.max(20, prevState.energy - 15);
                    newState.happiness = Math.min(100, prevState.happiness + 25);
                    newState.hunger = Math.max(0, prevState.hunger - 10);
                    break;
                  case 'sleep':
                    newState.energy = Math.min(100, prevState.energy + 40);
                    newState.hunger = Math.max(0, prevState.hunger - 5);
                    break;
                  default:
                    break;
                }
                if (newState.happiness > 70 && newState.energy > 70 && newState.hunger > 70) newState.mood = 'happy';
                else if (newState.happiness > 50 && newState.energy > 50 && newState.hunger > 50) newState.mood = 'content';
                else if (newState.hunger < 30) newState.mood = 'hungry';
                else if (newState.energy < 30) newState.mood = 'tired';
                else if (newState.happiness < 30) newState.mood = 'sad';
                else newState.mood = 'content';
                return newState;
              });
              setCats(prevCats => 
                prevCats.map(cat => ({
                  ...cat,
                  actionState: 'idle'
                }))
              );
              setIsAnimating(false);
              setCurrentAction('');
            }, 2500);
          };

          const getStatColor = (value) => {
            if (value > 70) return 'bg-green-500';
            if (value > 40) return 'bg-yellow-500';
            return 'bg-red-500';
          };

          const getMoodEmoji = (mood) => {
            switch (mood) {
              case 'happy': return 'üò∏';
              case 'content': return 'üò∫';
              case 'hungry': return 'üôÄ';
              case 'tired': return 'üò¥';
              case 'sad': return 'üòø';
              default: return 'üò∏';
            }
          };

          const getCatDisplay = (cat) => {
            const transformParts = ['translate(-50%, -50%)'];
            if (cat.direction < 0) transformParts.push('scaleX(-1)');
            if (cat.bobOffset) transformParts.push(`translateY(${cat.bobOffset}px)`);
            if (cat.tilt) transformParts.push(`rotate(${cat.tilt}deg)`);
            const transform = transformParts.join(' ');
            let extraElements = null;
            const avgStats = (gameState.happiness + gameState.energy + gameState.hunger) / 3;

            switch (cat.actionState) {
              case 'feed':
                extraElements = (
                  <div className="absolute -top-8 left-1/2 transform -translate-x-1/2">
                    <div className="text-lg animate-bounce">ü•õ</div>
                  </div>
                );
                break;
              case 'play':
                extraElements = (
                  <div className="absolute -top-8 left-1/2 transform -translate-x-1/2">
                    <div className="text-lg animate-pulse">üê≠</div>
                  </div>
                );
                break;
              case 'sleep':
                extraElements = (
                  <div className="absolute -top-6 left-1/2 transform -translate-x-1/2">
                    <div className="text-lg animate-pulse">üí§</div>
                  </div>
                );
                break;
              default:
                if (avgStats < 60) {
                  let angerEmoji = null;
                  if (avgStats < 20) angerEmoji = 'üò°';
                  else if (avgStats < 40) angerEmoji = 'üò†';
                  else angerEmoji = 'üò§';
                  extraElements = (
                    <div className="absolute -top-6 left-1/2 transform -translate-x-1/2">
                      <div className="text-lg animate-bounce">{angerEmoji}</div>
                    </div>
                  );
                }
                break;
            }

            const CatBody = ({ type }) => {
              const colors = {
                tuxedo: { body: 'bg-gray-900', chest: 'bg-white', ears: 'bg-gray-900' },
                gris: { body: 'bg-gray-400', chest: 'bg-white', ears: 'bg-gray-400' },
                siamese: { body: 'bg-yellow-100', face: 'bg-amber-800', ears: 'bg-amber-800' }
              }[type];

              const isSleeping = cat.actionState === 'sleep';

              return (
                <div className="relative w-16 h-16">
                  <div className={`absolute bottom-0 left-2 w-12 h-12 ${colors.body} rounded-full`}></div>
                  {(type === 'tuxedo' || type === 'gris') && (
                    <div className={`absolute bottom-1 left-4 w-8 h-9 ${colors.chest} rounded-full`}></div>
                  )}
                  <div className={`absolute top-0 left-2 w-12 h-12 ${colors.body} rounded-full`}></div>
                  {type === 'siamese' ? (
                    <div className={`absolute top-1 left-3 w-10 h-9 ${colors.face} rounded-full`}></div>
                  ) : (
                    <div>
                      <div className="absolute top-1 left-5 w-6 h-8 bg-white rounded-full"></div>
                      <div className="absolute top-6 left-7 w-2 h-3 bg-white transform rotate-45 rounded-sm"></div>
                    </div>
                  )}
                  <div className={`absolute -top-1 left-3 w-4 h-5 ${colors.ears} rounded-full transform -rotate-12`}></div>
                  <div className={`absolute -top-1 right-3 w-4 h-5 ${colors.ears} rounded-full transform rotate-12`}></div>
                  <div className="absolute top-0 left-4 w-2 h-3 bg-pink-300 rounded-full transform -rotate-12"></div>
                  <div className="absolute top-0 right-4 w-2 h-3 bg-pink-300 rounded-full transform rotate-12"></div>
                  {isSleeping ? (
                    <>
                      <div className="absolute top-4 left-4 w-2 h-1 bg-gray-800 rounded-full"></div>
                      <div className="absolute top-4 right-4 w-2 h-1 bg-gray-800 rounded-full"></div>
                    </>
                  ) : (
                    <>
                      <div className={`absolute top-4 left-4 w-2 h-2 ${type === 'siamese' ? 'bg-blue-500' : type === 'gris' ? 'bg-blue-400' : 'bg-green-400'} rounded-full`}></div>
                      <div className={`absolute top-4 right-4 w-2 h-2 ${type === 'siamese' ? 'bg-blue-500' : type === 'gris' ? 'bg-blue-400' : 'bg-green-400'} rounded-full`}></div>
                    </>
                  )}
                  <div className="absolute top-5 left-1/2 transform -translate-x-1/2 w-1 h-1 bg-pink-400 rounded-full"></div>
                  <div className={`absolute -right-1 bottom-3 w-3 h-8 ${colors.body} rounded-full transform rotate-45`}></div>
                  <div className={`absolute bottom-0 left-3 w-1.5 h-4 ${type === 'siamese' ? 'bg-amber-800' : colors.body} rounded-full`}></div>
                  <div className={`absolute bottom-0 right-3 w-1.5 h-4 ${type === 'siamese' ? 'bg-amber-800' : colors.body} rounded-full`}></div>
                </div>
              );
            };

            return (
              <div
                className="absolute transition-all duration-1000"
                style={{ left: `${cat.position.x}%`, top: `${cat.position.y}%`, transform }}
              >
                <CatBody type={cat.type} />
                {extraElements}
              </div>
            );
          };

          return (
            <div className="min-h-screen bg-gradient-to-br from-purple-400 via-pink-300 to-yellow-300 p-4">
              <div className="max-w-md mx-auto bg-white rounded-3xl shadow-2xl overflow-hidden">
                <div className="bg-gradient-to-r from-purple-500 to-pink-500 p-4 text-white text-center">
                  <h1 className="text-2xl font-bold">üê± Los Tres Gatitos üê±</h1>
                  <p className="text-sm opacity-90">Lukis, Arwen e Iria</p>
                </div>

                <div className={`relative h-64 ${isNightTime ? 'bg-gradient-to-b from-indigo-900 to-purple-900' : 'bg-gradient-to-b from-blue-100 to-green-200'} overflow-hidden transition-all duration-1000`}>
                  <div className="absolute bottom-0 w-full h-12 bg-amber-200"></div>
                  <div className="absolute left-0 top-0 w-2 h-full bg-amber-300"></div>
                  <div className="absolute right-0 top-0 w-2 h-full bg-amber-300"></div>
                  <div className="absolute top-0 w-full h-2 bg-amber-300"></div>

                  <div className="absolute top-4 right-4 w-24 h-20 bg-sky-200 border-4 border-amber-600 rounded">
                    <div className={`absolute inset-1 ${isNightTime ? 'bg-indigo-900' : 'bg-sky-100'} transition-all duration-1000`}>
                      <div className="w-full h-0.5 bg-amber-600 absolute top-1/2 transform -translate-y-1/2"></div>
                      <div className="h-full w-0.5 bg-amber-600 absolute left-1/2 transform -translate-x-1/2"></div>
                      {isNightTime ? (
                        <>
                          <div className="absolute top-2 right-2 w-6 h-6 bg-yellow-100 rounded-full shadow-lg"></div>
                          <div className="absolute top-1 left-2 text-yellow-200 text-xs">‚ú¶</div>
                        </>
                      ) : (
                        <>
                          <div className="absolute top-2 left-2 w-8 h-8 bg-yellow-400 rounded-full animate-pulse"></div>
                          <div className="absolute top-1 right-1 w-4 h-2 bg-white rounded-full opacity-70"></div>
                        </>
                      )}
                    </div>
                    <div className="absolute -top-1 -left-2 w-5 h-20 bg-pink-300 rounded-r-lg"></div>
                    <div className="absolute -top-1 -right-2 w-5 h-20 bg-pink-300 rounded-l-lg"></div>
                  </div>

                  <div className="absolute bottom-12 left-4 w-12 h-6 bg-red-400 rounded-full border-2 border-red-500"></div>
                  <div className="absolute bottom-12 right-8 w-6 h-3 bg-gray-300 rounded-full border border-gray-400"></div>
                  <div className="absolute bottom-12 right-16 w-6 h-3 bg-gray-300 rounded-full border border-gray-400"></div>
                  <div className="absolute bottom-12 right-24 w-6 h-3 bg-gray-300 rounded-full border border-gray-400"></div>
                  <div className="absolute bottom-12 left-1/4 w-36 h-10 bg-purple-300 rounded-lg opacity-60"></div>

                  {cats.map((cat, index) => (
                    <div key={index}>{getCatDisplay(cat)}</div>
                  ))}
                </div>

                <div className="p-4 text-center bg-gray-50">
                  <div className="flex justify-center items-center space-x-2 mb-2">
                    <span className="text-lg">{getMoodEmoji(gameState.mood)}</span>
                    <span className="text-sm text-gray-600 capitalize">
                      Estado: {gameState.mood === 'happy' ? 'Felices' : 
                             gameState.mood === 'content' ? 'Tranquilos' :
                             gameState.mood === 'hungry' ? 'Hambrientos' :
                             gameState.mood === 'tired' ? 'Cansados' :
                             gameState.mood === 'sad' ? 'Tristes' : 'Juguetones'}
                    </span>
                  </div>
                  <div className="flex justify-center items-center space-x-2">
                    <span className="text-base" role="img" aria-hidden="true">
                      {isNightTime ? 'üåô' : '‚òÄÔ∏è'}
                    </span>
                    <span className="text-xs text-gray-500">
                      {isNightTime ? 'Hora de dormir' : 'D√≠a activo'}
                    </span>
                  </div>
                </div>

                <div className="px-6 pb-6 space-y-3">
                  <div className="flex items-center space-x-3">
                    <span className="text-red-500 text-xl" role="img" aria-hidden="true">‚ù§Ô∏è</span>
                    <div className="flex-1">
                      <div className="flex justify-between text-sm mb-1">
                        <span className="font-medium">Felicidad</span>
                        <span>{Math.round(gameState.happiness)}%</span>
                      </div>
                      <div className="w-full bg-gray-200 rounded-full h-2">
                        <div
                          className={`h-2 rounded-full transition-all duration-500 ${getStatColor(gameState.happiness)}`}
                          style={{ width: `${gameState.happiness}%` }}
                        ></div>
                      </div>
                    </div>
                  </div>

                  <div className="flex items-center space-x-3">
                    <span className="text-green-500 text-xl" role="img" aria-hidden="true">üîã</span>
                    <div className="flex-1">
                      <div className="flex justify-between text-sm mb-1">
                        <span className="font-medium">Energ√≠a</span>
                        <span>{Math.round(gameState.energy)}%</span>
                      </div>
                      <div className="w-full bg-gray-200 rounded-full h-2">
                        <div
                          className={`h-2 rounded-full transition-all duration-500 ${getStatColor(gameState.energy)}`}
                          style={{ width: `${gameState.energy}%` }}
                        ></div>
                      </div>
                    </div>
                  </div>

                  <div className="flex items-center space-x-3">
                    <span className="text-yellow-600 text-xl" role="img" aria-hidden="true">üçó</span>
                    <div className="flex-1">
                      <div className="flex justify-between text-sm mb-1">
                        <span className="font-medium">Hambre</span>
                        <span>{Math.round(gameState.hunger)}%</span>
                      </div>
                      <div className="w-full bg-gray-200 rounded-full h-2">
                        <div
                          className={`h-2 rounded-full transition-all duration-500 ${
                            gameState.hunger < 30 ? 'bg-red-500' :
                            gameState.hunger < 60 ? 'bg-yellow-500' : 'bg-green-500'
                          }`}
                          style={{ width: `${gameState.hunger}%` }}
                        ></div>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="p-6 bg-gray-50 flex justify-center space-x-4">
                  <button
                    onClick={() => handleAction('feed')}
                    disabled={isAnimating}
                    className="flex flex-col items-center space-y-2 px-4 py-3 bg-green-500 hover:bg-green-600 disabled:bg-gray-400 text-white rounded-2xl transition-all duration-300 transform hover:scale-105 disabled:scale-100"
                  >
                    <span className="text-2xl" role="img" aria-hidden="true">üç≤</span>
                    <span className="text-xs font-medium">Comer</span>
                  </button>

                  <button
                    onClick={() => handleAction('play')}
                    disabled={isAnimating}
                    className="flex flex-col items-center space-y-2 px-4 py-3 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-400 text-white rounded-2xl transition-all duration-300 transform hover:scale-105 disabled:scale-100"
                  >
                    <span className="text-2xl" role="img" aria-hidden="true">üß∂</span>
                    <span className="text-xs font-medium">Jugar</span>
                  </button>

                  <button
                    onClick={() => handleAction('sleep')}
                    disabled={isAnimating}
                    className="flex flex-col items-center space-y-2 px-4 py-3 bg-purple-500 hover:bg-purple-600 disabled:bg-gray-400 text-white rounded-2xl transition-all duration-300 transform hover:scale-105 disabled:scale-100"
                  >
                    <span className="text-2xl" role="img" aria-hidden="true">üåô</span>
                    <span className="text-xs font-medium">Dormir</span>
                  </button>
                </div>

                {currentAction && (
                  <div className="px-6 pb-6">
                    <div className="bg-purple-100 text-purple-700 rounded-2xl p-3 text-center text-sm font-medium animate-pulse">
                      Ejecutando acci√≥n: {currentAction === 'feed' ? 'Comer' : currentAction === 'play' ? 'Jugar' : 'Dormir'}...
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<CatTamagotchi />);
    </script>
</body>
</html>
