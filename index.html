<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Catagotchi ¬∑ Cuida a tu gato virtual</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Poppins:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        color-scheme: light;
        --bg-primary: radial-gradient(circle at top, #ffe3f1 0%, #ffb7d5 36%, #ff86c6 70%, #f564a5 100%);
        --shell-main: #ff85c5;
        --shell-highlight: #ffd6ec;
        --shell-shadow: #d43c8c;
        --screen-sky: #bde9ff;
        --screen-ground: #ffe7b5;
        --screen-glow: rgba(255, 255, 255, 0.36);
        --screen-border: #ffbcd9;
        --hud-bg: rgba(255, 255, 255, 0.36);
        --hud-border: #ff9cca;
        --hud-text: #87245f;
        --stat-bg: rgba(255, 255, 255, 0.42);
        --stat-border: #ff87c9;
        --progress-bg: rgba(255, 255, 255, 0.5);
        --progress-fill: linear-gradient(90deg, #ff9bc6 0%, #ffda85 100%);
        --progress-fill-cool: linear-gradient(90deg, #8bc6ff 0%, #74f2ff 100%);
        --progress-fill-fun: linear-gradient(90deg, #f996ff 0%, #ffa4d4 100%);
        --progress-fill-health: linear-gradient(90deg, #7dffb5 0%, #52d5a4 100%);
        --text-primary: #53163c;
        --text-secondary: #a13a6f;
        --button-bg: #ffe5f3;
        --button-shadow: #ffa4d0;
        --device-shadow: rgba(218, 44, 129, 0.28);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--bg-primary);
        font-family: "Poppins", sans-serif;
        color: var(--text-primary);
        padding: 32px 18px;
      }

      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background: radial-gradient(circle at 20% 20%, rgba(255, 255, 255, 0.4), transparent 55%),
          radial-gradient(circle at 80% 25%, rgba(255, 255, 255, 0.35), transparent 45%);
        pointer-events: none;
        opacity: 0.45;
      }

      main.device {
        position: relative;
        width: min(480px, 92vw);
        padding: 42px 34px 58px;
        border-radius: 220px 220px 280px 280px;
        background: radial-gradient(circle at 50% 18%, var(--shell-highlight), var(--shell-main) 55%, var(--shell-shadow) 120%);
        box-shadow: 0 40px 80px var(--device-shadow), inset 0 0 0 6px rgba(255, 255, 255, 0.4);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 18px;
      }

      main.device::before {
        content: "";
        position: absolute;
        inset: 16px 22px;
        border-radius: 180px 180px 240px 240px;
        border: 4px solid rgba(255, 255, 255, 0.45);
        pointer-events: none;
      }

      .device-header {
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 6px;
        z-index: 1;
      }

      .device-logo {
        font-family: "Press Start 2P", system-ui;
        font-size: clamp(1.05rem, 1.8vw, 1.35rem);
        letter-spacing: 0.12em;
        text-transform: uppercase;
        color: #ffeef8;
        text-shadow: 0 5px 0 rgba(0, 0, 0, 0.15), 0 0 24px rgba(255, 255, 255, 0.45);
      }

      .device-lights {
        display: flex;
        gap: 10px;
      }

      .device-lights span {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.65);
        box-shadow: 0 0 12px rgba(255, 255, 255, 0.9);
        animation: twinkle 3.4s ease-in-out infinite;
      }

      .device-lights span:nth-child(2) {
        animation-delay: 0.8s;
      }

      .device-lights span:nth-child(3) {
        animation-delay: 1.6s;
      }

      .name-band {
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap;
        gap: 12px;
        padding: 12px 14px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.45);
        border: 3px solid rgba(255, 255, 255, 0.65);
        box-shadow: inset 0 0 12px rgba(255, 255, 255, 0.35);
        font-weight: 600;
        color: var(--text-secondary);
      }

      .name-field {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-family: "Press Start 2P", system-ui;
        font-size: 0.62rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
      }

      .name-field input {
        border: none;
        background: rgba(255, 255, 255, 0.7);
        border-radius: 10px;
        padding: 6px 8px 4px;
        font: inherit;
        color: var(--text-primary);
        width: 120px;
        text-transform: uppercase;
      }

      .name-field input::placeholder {
        color: rgba(122, 54, 88, 0.55);
      }

      .name-field input:focus {
        outline: 2px solid rgba(255, 118, 197, 0.75);
        outline-offset: 2px;
      }

      .chip {
        font-family: "Press Start 2P", system-ui;
        font-size: 0.58rem;
        letter-spacing: 0.08em;
        background: rgba(255, 255, 255, 0.75);
        color: var(--text-primary);
        padding: 6px 10px 4px;
        border-radius: 999px;
        border: 2px solid rgba(255, 118, 197, 0.5);
        box-shadow: 0 4px 0 rgba(255, 118, 197, 0.35);
      }

      .screen-section {
        width: 100%;
      }

      .screen {
        position: relative;
        display: flex;
        flex-direction: column;
        gap: 18px;
        background: linear-gradient(180deg, var(--screen-sky) 0%, var(--screen-ground) 70%);
        border-radius: 36px;
        border: 4px solid var(--screen-border);
        box-shadow: inset 0 0 0 3px rgba(255, 255, 255, 0.6), inset 0 0 45px var(--screen-glow);
        padding: 20px 18px 18px;
        font-family: "Press Start 2P", system-ui;
        letter-spacing: 0.05em;
        color: var(--hud-text);
      }

      .day-switch {
        align-self: flex-end;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        border: none;
        border-radius: 999px;
        padding: 6px 10px;
        font: inherit;
        font-size: 0.62rem;
        text-transform: uppercase;
        background: rgba(255, 255, 255, 0.4);
        border: 2px solid rgba(255, 255, 255, 0.7);
        color: inherit;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .day-switch:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 0 rgba(255, 118, 197, 0.35);
      }

      .day-switch:focus-visible {
        outline: 2px solid rgba(89, 148, 255, 0.8);
        outline-offset: 2px;
      }

      .scene {
        position: relative;
        height: clamp(220px, 42vw, 260px);
        border-radius: 26px;
        overflow: hidden;
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.45) 0%, rgba(255, 255, 255, 0.05) 60%, transparent 100%);
        border: 2px dashed rgba(255, 255, 255, 0.4);
      }

      .scene::before,
      .scene::after {
        content: "";
        position: absolute;
        inset: 0;
        pointer-events: none;
      }

      .scene::before {
        background: radial-gradient(circle at 20% 25%, rgba(255, 255, 255, 0.7), transparent 60%),
          radial-gradient(circle at 85% 18%, rgba(255, 255, 255, 0.5), transparent 55%);
        opacity: 0.75;
      }

      .scene::after {
        bottom: -10px;
        top: auto;
        height: 120px;
        background: repeating-linear-gradient(0deg, rgba(255, 255, 255, 0.32) 0 2px, transparent 2px 8px);
        opacity: 0.5;
      }

      .scene-floor {
        position: absolute;
        inset: auto 0 0;
        height: 38%;
        background: linear-gradient(180deg, rgba(255, 229, 184, 0.7), rgba(255, 190, 150, 0.4));
        border-top: 2px solid rgba(255, 255, 255, 0.6);
      }

      .cat-wanderer {
        --x: 0px;
        --y: 0px;
        --flip: 1;
        --scale: 1;
        --bob-speed: 3.2s;
        --shadow-opacity: 0.45;
        position: absolute;
        left: 50%;
        bottom: 38px;
        width: clamp(160px, 40vw, 220px);
        transform: translate(calc(-50% + var(--x)), var(--y));
        transition: transform 2.4s cubic-bezier(0.55, 0, 0.25, 1);
        will-change: transform;
      }

      .cat-shadow {
        position: absolute;
        left: 50%;
        bottom: -20px;
        width: 70%;
        height: 26px;
        background: rgba(0, 0, 0, 0.18);
        border-radius: 50%;
        transform: translateX(-50%) scaleX(calc(0.95 + (var(--scale) - 1) * 0.6));
        filter: blur(4px);
        opacity: var(--shadow-opacity);
        transition: transform 2.4s cubic-bezier(0.55, 0, 0.25, 1), opacity 0.6s ease;
      }

      .cat {
        position: relative;
        width: 100%;
        transform: scaleX(var(--flip)) scale(var(--scale));
        transform-origin: center bottom;
        animation: bob var(--bob-speed) ease-in-out infinite;
        filter: drop-shadow(0 10px 18px rgba(112, 41, 104, 0.25));
      }

      .cat svg {
        width: 100%;
        height: auto;
      }

      .cat[data-mood="feliz"] svg {
        filter: saturate(1.1) brightness(1.05) drop-shadow(0 10px 18px rgba(112, 41, 104, 0.25));
      }

      .cat[data-mood="triste"] svg,
      .cat[data-mood="enfadado"] svg {
        filter: saturate(0.85) brightness(0.92) drop-shadow(0 10px 18px rgba(112, 41, 104, 0.2));
      }

      .screen-hud {
        background: var(--hud-bg);
        border: 3px solid var(--hud-border);
        border-radius: 24px;
        padding: 14px 16px;
        display: flex;
        flex-direction: column;
        gap: 16px;
        box-shadow: inset 0 0 12px rgba(255, 255, 255, 0.35);
      }

      .hud-top {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        align-items: center;
        justify-content: space-between;
      }

      .mood-chip {
        padding: 6px 12px 5px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.75);
        border: 2px solid rgba(255, 118, 197, 0.45);
        font-size: 0.65rem;
        letter-spacing: 0.08em;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .xp-bar {
        flex: 1;
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 0.62rem;
        text-transform: uppercase;
      }

      .progress-track {
        flex: 1;
        height: 10px;
        border-radius: 999px;
        background: var(--progress-bg);
        border: 2px solid rgba(255, 255, 255, 0.7);
        overflow: hidden;
      }

      .progress-fill {
        width: var(--value, 50%);
        height: 100%;
        background: var(--progress-fill);
        border-radius: inherit;
        transition: width 0.6s ease;
      }

      .stat-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        font-size: 0.58rem;
      }

      .stat {
        position: relative;
        padding: 10px 12px 12px;
        border-radius: 18px;
        background: var(--stat-bg);
        border: 2px solid var(--stat-border);
        box-shadow: inset 0 0 8px rgba(255, 255, 255, 0.28);
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .stat[data-theme="cool"] .progress-fill {
        background: var(--progress-fill-cool);
      }

      .stat[data-theme="fun"] .progress-fill {
        background: var(--progress-fill-fun);
      }

      .stat[data-theme="health"] .progress-fill {
        background: var(--progress-fill-health);
      }

      .stat-title {
        display: flex;
        justify-content: space-between;
        text-transform: uppercase;
      }

      .stat-value {
        position: absolute;
        top: 10px;
        right: 12px;
      }

      .progress-bar {
        width: 100%;
        height: 9px;
        border-radius: 999px;
        border: 2px solid rgba(255, 255, 255, 0.7);
        background: var(--progress-bg);
        overflow: hidden;
      }

      .activity-log {
        max-height: 180px;
        overflow-y: auto;
        display: grid;
        gap: 10px;
        font-family: "Poppins", sans-serif;
        font-size: 0.85rem;
        color: var(--text-primary);
      }

      .log-window {
        width: 100%;
        background: rgba(255, 255, 255, 0.48);
        border-radius: 26px;
        border: 3px solid rgba(255, 255, 255, 0.7);
        padding: 18px 18px 20px;
        box-shadow: inset 0 0 12px rgba(255, 255, 255, 0.32);
      }

      .log-title {
        font-family: "Press Start 2P", system-ui;
        font-size: 0.72rem;
        letter-spacing: 0.08em;
        margin: 0 0 14px;
        text-transform: uppercase;
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .log-entry {
        background: rgba(255, 255, 255, 0.78);
        border: 2px dashed rgba(255, 134, 201, 0.65);
        border-radius: 16px;
        padding: 10px 12px;
        display: grid;
        gap: 6px;
      }

      .log-time {
        font-family: "Press Start 2P", system-ui;
        font-size: 0.55rem;
        letter-spacing: 0.08em;
        color: rgba(130, 52, 92, 0.7);
      }

      .log-text {
        line-height: 1.45;
      }

      .button-row {
        width: 100%;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(48px, 1fr));
        gap: 18px;
        justify-items: center;
        margin-top: 6px;
      }

      .device-button {
        position: relative;
        width: 58px;
        height: 58px;
        border-radius: 50%;
        border: none;
        background: var(--button-bg);
        box-shadow: 0 10px 0 var(--button-shadow);
        display: grid;
        place-items: center;
        font-size: 1.8rem;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .device-button::after {
        content: attr(data-label);
        position: absolute;
        bottom: -28px;
        left: 50%;
        transform: translateX(-50%) translateY(4px);
        background: rgba(255, 255, 255, 0.82);
        color: var(--text-primary);
        font-family: "Press Start 2P", system-ui;
        font-size: 0.48rem;
        padding: 4px 6px;
        border-radius: 6px;
        border: 1px solid rgba(255, 134, 201, 0.5);
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s ease, transform 0.2s ease;
        white-space: nowrap;
      }

      .device-button:hover,
      .device-button:focus-visible {
        transform: translateY(2px);
        box-shadow: 0 6px 0 var(--button-shadow);
      }

      .device-button:hover::after,
      .device-button:focus-visible::after {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }

      .device-button:active {
        transform: translateY(6px);
        box-shadow: 0 4px 0 var(--button-shadow);
      }

      .device-button:focus-visible {
        outline: 2px solid rgba(89, 148, 255, 0.8);
        outline-offset: 3px;
      }

      .toast {
        position: fixed;
        left: 50%;
        bottom: 24px;
        transform: translate(-50%, 120%);
        background: rgba(255, 255, 255, 0.92);
        color: var(--text-primary);
        border-radius: 18px;
        border: 2px solid rgba(255, 134, 201, 0.6);
        padding: 12px 16px;
        display: inline-flex;
        gap: 10px;
        align-items: center;
        font-weight: 600;
        box-shadow: 0 20px 32px rgba(215, 64, 150, 0.25);
        transition: transform 0.4s ease;
        z-index: 10;
      }

      .toast.show {
        transform: translate(-50%, 0);
      }

      .toast span:first-child {
        font-size: 1.4rem;
      }

      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      body[data-mode="night"] {
        --bg-primary: radial-gradient(circle at top, #2b1b68 0%, #1d0f51 42%, #10063a 75%, #040019 100%);
        --screen-sky: #2e3c8c;
        --screen-ground: #4d2d7a;
        --screen-glow: rgba(122, 162, 255, 0.2);
        --screen-border: #8f88ff;
        --hud-bg: rgba(24, 18, 61, 0.55);
        --hud-border: rgba(141, 129, 255, 0.6);
        --hud-text: #e2dcff;
        --stat-bg: rgba(39, 29, 84, 0.65);
        --stat-border: rgba(165, 153, 255, 0.55);
        --progress-bg: rgba(255, 255, 255, 0.35);
        --text-primary: #f6f4ff;
        --text-secondary: #c7c1ff;
        --button-bg: #ede9ff;
        --button-shadow: #a29dff;
        color: var(--text-primary);
      }

      body[data-mode="night"] .scene::before {
        background: radial-gradient(circle at 20% 24%, rgba(255, 255, 255, 0.35), transparent 50%),
          radial-gradient(circle at 70% 20%, rgba(255, 255, 255, 0.4), transparent 45%),
          radial-gradient(circle at 40% 18%, rgba(255, 255, 255, 0.35), transparent 45%);
        opacity: 0.5;
      }

      body[data-mode="night"] .scene::after {
        background: repeating-linear-gradient(0deg, rgba(255, 255, 255, 0.25) 0 2px, transparent 2px 7px);
        opacity: 0.35;
      }

      body[data-mode="night"] .cat-shadow {
        background: rgba(6, 2, 30, 0.4);
      }

      body[data-mode="night"] .device-logo {
        color: #ffeefd;
        text-shadow: 0 5px 0 rgba(0, 0, 0, 0.3), 0 0 22px rgba(138, 126, 255, 0.6);
      }

      body[data-mode="night"] .log-window {
        background: rgba(24, 18, 61, 0.65);
        border: 3px solid rgba(141, 129, 255, 0.55);
      }

      body[data-mode="night"] .log-entry {
        background: rgba(35, 26, 80, 0.85);
        border-color: rgba(170, 158, 255, 0.55);
        color: var(--text-primary);
      }

      body[data-mode="night"] .log-time {
        color: rgba(212, 206, 255, 0.75);
      }

      body[data-mode="night"] .device-button::after {
        background: rgba(32, 24, 74, 0.85);
        color: #f6f4ff;
        border-color: rgba(170, 158, 255, 0.55);
      }

      body[data-mode="night"] .toast {
        background: rgba(29, 21, 68, 0.92);
        color: var(--text-primary);
        border-color: rgba(141, 129, 255, 0.55);
        box-shadow: 0 20px 32px rgba(37, 23, 85, 0.4);
      }

      @media (max-width: 520px) {
        main.device {
          padding: 34px 24px 48px;
        }

        .stat-grid {
          grid-template-columns: 1fr;
        }

        .screen {
          padding: 18px 14px 16px;
        }

        .name-field input {
          width: 100px;
        }

        .device-button::after {
          bottom: -24px;
        }
      }

      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.4);
      }

      ::-webkit-scrollbar-thumb {
        background: linear-gradient(180deg, rgba(255, 134, 201, 0.8), rgba(255, 214, 138, 0.9));
        border-radius: 999px;
      }

      @keyframes bob {
        0%,
        100% {
          transform: scaleX(var(--flip)) scale(var(--scale)) translateY(0);
        }
        50% {
          transform: scaleX(var(--flip)) scale(calc(var(--scale) + 0.02)) translateY(-6px);
        }
      }

      @keyframes twinkle {
        0%,
        100% {
          opacity: 0.85;
          transform: scale(1);
        }
        50% {
          opacity: 0.35;
          transform: scale(0.75);
        }
      }
    </style>
  </head>
  <body data-mode="day">
    <main class="device">
      <header class="device-header">
        <div class="device-logo">Catagotchi</div>
        <div class="device-lights"><span></span><span></span><span></span></div>
      </header>
      <div class="name-band">
        <label class="name-field" for="catName">
          <span>Nombre</span>
          <input id="catName" maxlength="16" placeholder="PIXEL" />
        </label>
        <div class="chip">Nivel <strong id="level-label">1</strong></div>
        <div class="chip">Vet <strong id="vet-timer">--:--</strong></div>
      </div>
      <section class="screen-section" aria-labelledby="panel-estado">
        <div class="screen" role="region" aria-live="polite">
          <button class="day-switch" id="daySwitch" type="button" aria-label="Cambiar entorno">
            <span id="dayEmoji">üåû</span>
            <span id="dayLabel">Parque soleado</span>
          </button>
          <div class="scene" id="catScene">
            <div class="scene-floor"></div>
            <div class="cat-wanderer" id="catWanderer">
              <div class="cat-shadow"></div>
              <div class="cat" id="cat" data-mood="feliz">
                <svg viewBox="0 0 320 320" role="img" aria-label="Gato virtual">
                  <defs>
                    <radialGradient id="furGradient" cx="50%" cy="35%" r="70%">
                      <stop offset="0%" stop-color="#ffe6cc" />
                      <stop offset="60%" stop-color="#f3b37b" />
                      <stop offset="100%" stop-color="#d48f5a" />
                    </radialGradient>
                    <radialGradient id="earGradient" cx="50%" cy="50%" r="50%">
                      <stop offset="0%" stop-color="#ffb6d9" />
                      <stop offset="100%" stop-color="#f38cc7" />
                    </radialGradient>
                  </defs>
                  <ellipse cx="160" cy="256" rx="96" ry="30" fill="rgba(15, 8, 40, 0.18)" />
                  <g id="cat-body">
                    <path
                      d="M60 120 C40 40, 90 40, 120 90 C140 45, 180 45, 200 90 C220 45, 260 45, 280 120 C290 160, 290 240, 240 270 C220 285, 190 295, 160 295 C130 295, 100 285, 80 270 C30 240, 30 160, 40 120 Z"
                      fill="url(#furGradient)"
                      stroke="#d48f5a"
                      stroke-width="4"
                    />
                    <path
                      d="M60 120 C40 40, 90 40, 120 90 C140 45, 180 45, 200 90 C220 45, 260 45, 280 120"
                      fill="none"
                      stroke="rgba(255, 255, 255, 0.3)"
                      stroke-width="6"
                      stroke-linecap="round"
                    />
                    <path d="M120 90 Q160 40 200 90" fill="rgba(255, 255, 255, 0.08)" />
                    <path d="M100 110 C140 135, 180 135, 220 110" stroke="rgba(255, 255, 255, 0.2)" stroke-width="6" />
                  </g>
                  <g id="ears">
                    <path d="M90 96 L68 36 Q108 24 126 70 Z" fill="#d48f5a" />
                    <path d="M90 96 L74 52 Q110 42 122 74 Z" fill="url(#earGradient)" opacity="0.85" />
                    <path d="M230 96 L252 36 Q212 24 194 70 Z" fill="#d48f5a" />
                    <path d="M230 96 L246 52 Q210 42 198 74 Z" fill="url(#earGradient)" opacity="0.85" />
                  </g>
                  <g id="face" fill="#1b0a2c">
                    <ellipse class="eye" cx="125" cy="160" rx="18" ry="22" />
                    <ellipse class="eye" cx="195" cy="160" rx="18" ry="22" />
                    <circle class="pupil" cx="125" cy="160" r="9" fill="#0a0315" />
                    <circle class="pupil" cx="195" cy="160" r="9" fill="#0a0315" />
                    <path id="mouth" d="M150 190 Q160 205 170 190" stroke="#1b0a2c" stroke-width="6" fill="none" stroke-linecap="round" />
                    <path d="M160 174 Q160 190 148 192" stroke="#f59cb3" stroke-width="4" stroke-linecap="round" />
                    <path d="M160 174 Q160 190 172 192" stroke="#f59cb3" stroke-width="4" stroke-linecap="round" />
                    <circle cx="140" cy="176" r="10" fill="#f59cb3" opacity="0.7" />
                    <circle cx="180" cy="176" r="10" fill="#f59cb3" opacity="0.7" />
                  </g>
                  <g id="tail">
                    <path
                      d="M278 210 C310 190, 310 150, 280 120"
                      stroke="#d48f5a"
                      stroke-width="18"
                      stroke-linecap="round"
                      fill="none"
                    />
                  </g>
                  <g id="accessory" opacity="0">
                    <path
                      d="M130 232 C150 220, 170 220, 190 232 L180 246 C167 242, 153 242, 140 246 Z"
                      fill="#6ee7ff"
                      stroke="#4aa5ff"
                      stroke-width="3"
                    />
                  </g>
                </svg>
              </div>
            </div>
          </div>
          <div class="screen-hud">
            <div class="hud-top">
              <div class="mood-chip" id="moodLabel">‚ú® Feliz</div>
              <div class="xp-bar">
                <span>XP</span>
                <div class="progress-track"><div class="progress-fill" id="xpBar"></div></div>
              </div>
            </div>
            <div class="stat-grid">
              <article class="stat" data-tooltip="Panza llena">
                <div class="stat-title">
                  <span>Panza</span>
                  <span class="stat-value" id="hungerValue">80%</span>
                </div>
                <div class="progress-bar"><div class="progress-fill" id="hungerBar"></div></div>
              </article>
              <article class="stat" data-theme="cool">
                <div class="stat-title">
                  <span>Energ√≠a</span>
                  <span class="stat-value" id="energyValue">80%</span>
                </div>
                <div class="progress-bar"><div class="progress-fill" id="energyBar"></div></div>
              </article>
              <article class="stat" data-theme="fun">
                <div class="stat-title">
                  <span>Diversi√≥n</span>
                  <span class="stat-value" id="funValue">80%</span>
                </div>
                <div class="progress-bar"><div class="progress-fill" id="funBar"></div></div>
              </article>
              <article class="stat">
                <div class="stat-title">
                  <span>Aseo</span>
                  <span class="stat-value" id="cleanValue">80%</span>
                </div>
                <div class="progress-bar"><div class="progress-fill" id="cleanBar"></div></div>
              </article>
              <article class="stat" data-theme="health">
                <div class="stat-title">
                  <span>Salud</span>
                  <span class="stat-value" id="healthValue">80%</span>
                </div>
                <div class="progress-bar"><div class="progress-fill" id="healthBar"></div></div>
              </article>
            </div>
          </div>
        </div>
      </section>
      <section class="log-window" aria-live="polite">
        <h2 class="log-title">Diario</h2>
        <div class="activity-log" id="log"></div>
      </section>
      <div class="button-row">
        <button class="device-button" data-action="feed" data-label="Comer" aria-label="Alimentar">üç£</button>
        <button class="device-button" data-action="play" data-label="Jugar" aria-label="Jugar">üß∂</button>
        <button class="device-button" data-action="groom" data-label="Aseo" aria-label="Ba√±o y cepillado">üõÅ</button>
        <button class="device-button" data-action="nap" data-label="Dormir" aria-label="Siestita">üò¥</button>
        <button class="device-button" data-action="vet" data-label="Vet" aria-label="Visita al veterinario">üíâ</button>
        <button class="device-button" data-action="surprise" data-label="Sorp" aria-label="Sorpresa">üéÅ</button>
      </div>
    </main>

    <div class="toast" id="toast" role="status" aria-live="polite">
      <span id="toastEmoji"></span>
      <span id="toastMessage"></span>
    </div>

    <template id="logEntryTemplate">
      <article class="log-entry">
        <div class="log-time"></div>
        <div class="log-text"></div>
      </article>
    </template>

    <script>
      const STORAGE_KEY = "catagotchi-state-v2";
      const MIN_STAT = 0;
      const MAX_STAT = 100;
      const catNameInput = document.getElementById("catName");
      const levelLabel = document.getElementById("level-label");
      const vetTimer = document.getElementById("vet-timer");
      const daySwitch = document.getElementById("daySwitch");
      const dayEmoji = document.getElementById("dayEmoji");
      const dayLabel = document.getElementById("dayLabel");
      const catScene = document.getElementById("catScene");
      const catWanderer = document.getElementById("catWanderer");
      const cat = document.getElementById("cat");
      const hungerBar = document.getElementById("hungerBar");
      const hungerValue = document.getElementById("hungerValue");
      const energyBar = document.getElementById("energyBar");
      const energyValue = document.getElementById("energyValue");
      const funBar = document.getElementById("funBar");
      const funValue = document.getElementById("funValue");
      const cleanBar = document.getElementById("cleanBar");
      const cleanValue = document.getElementById("cleanValue");
      const healthBar = document.getElementById("healthBar");
      const healthValue = document.getElementById("healthValue");
      const xpBar = document.getElementById("xpBar");
      const moodLabel = document.getElementById("moodLabel");
      const toast = document.getElementById("toast");
      const toastEmoji = document.getElementById("toastEmoji");
      const toastMessage = document.getElementById("toastMessage");
      const log = document.getElementById("log");
      const logEntryTemplate = document.getElementById("logEntryTemplate");

      const defaultState = {
        name: "Pixel",
        hunger: 80,
        energy: 80,
        fun: 80,
        clean: 80,
        health: 80,
        xp: 0,
        level: 1,
        lastTick: Date.now(),
        history: [],
        vetCooldown: 0,
        accessoriesUnlocked: false,
        dayMode: "day",
      };

      const state = loadState();

      const actions = {
        feed: {
          emoji: "üç£",
          text: () => `${getName()} disfruta del mejor salm√≥n nigiri.`,
          effects: { hunger: +24, fun: +6, energy: -4, clean: -6 },
          xp: 12,
        },
        play: {
          emoji: "üß∂",
          text: () => `${getName()} persigue el ovillo como si fuera la √∫ltima vez.`,
          effects: { fun: +24, energy: -12, hunger: -8, health: +3 },
          xp: 16,
        },
        groom: {
          emoji: "üõÅ",
          text: () => `Sesi√≥n de spa: ${getName()} queda impecable y relajado.`,
          effects: { clean: +26, health: +10, fun: -4 },
          xp: 14,
        },
        nap: {
          emoji: "üò¥",
          text: () => `${getName()} ronronea mientras duerme la siesta.`,
          effects: { energy: +32, hunger: -8, fun: -6, health: +4 },
          xp: 10,
        },
        vet: {
          emoji: "üíâ",
          text: () => `Visita m√©dica: ${getName()} recibe una revisi√≥n completa.`,
          effects: { health: +28, fun: -12, energy: -6, clean: -4 },
          xp: 18,
          cooldown: 120000,
        },
        surprise: {
          emoji: "üéÅ",
          text: () => {
            const surprises = [
              `¬°Nueva pluma brillante! ${getName()} salta de emoci√≥n.`,
              `${getName()} descubre un rayo de sol perfecto para dormir.`,
              `Encuentras una caja misteriosa. Dentro hab√≠a snacks crujientes.`,
              `${getName()} aprende un truco nuevo y lo presume orgulloso.`,
            ];
            return surprises[Math.floor(Math.random() * surprises.length)];
          },
          effects: () => randomSurpriseEffects(),
          xp: 20,
        },
      };

      const baseDegradeRates = {
        hunger: -2.6,
        energy: -2.2,
        fun: -2.4,
        clean: -1.8,
        health: -0.5,
      };

      let degradeRates = { ...baseDegradeRates };
      const tickInterval = 2500;
      let wanderIntervalId;
      const catMotion = { x: 0, y: 0 };

      initialize();
      setInterval(tick, tickInterval);

      function initialize() {
        catNameInput.value = state.name;
        catNameInput.addEventListener("change", () => {
          state.name = catNameInput.value.trim() || "Pixel";
          saveState();
          pushLog(`Ahora se llama ${state.name}.`, "‚ú®");
        });

        document.querySelectorAll(".device-button").forEach((btn) => {
          btn.addEventListener("click", () => handleAction(btn.dataset.action));
        });

        daySwitch.addEventListener("click", toggleDayMode);

        if (state.history.length === 0) {
          pushLog(`Comienza una nueva aventura con ${state.name}.`, "üöÄ");
        } else {
          state.history.forEach((entry) => addLogEntry(entry));
        }

        updateUI();
        updateDayMode();
        updateVetTimer();
        startCatWander();
      }

      function loadState() {
        try {
          const stored = localStorage.getItem(STORAGE_KEY);
          if (!stored) return structuredClone(defaultState);
          const parsed = JSON.parse(stored);
          return { ...structuredClone(defaultState), ...parsed };
        } catch (error) {
          console.error("Error cargando estado", error);
          return structuredClone(defaultState);
        }
      }

      function saveState() {
        try {
          const copy = { ...state, history: state.history.slice(-25) };
          localStorage.setItem(STORAGE_KEY, JSON.stringify(copy));
        } catch (error) {
          console.error("Error guardando estado", error);
        }
      }

      function tick() {
        const now = Date.now();
        const delta = (now - state.lastTick) / 1000;
        state.lastTick = now;

        Object.entries(degradeRates).forEach(([stat, rate]) => {
          modifyStat(stat, rate * delta);
        });

        if (state.hunger < 35 || state.clean < 30 || state.fun < 30) {
          modifyStat("health", -1.5 * delta);
        }
        if (state.energy < 25) {
          modifyStat("fun", -1.2 * delta);
        }

        if (state.vetCooldown > 0) {
          state.vetCooldown = Math.max(0, state.vetCooldown - tickInterval);
        }

        updateUI();
        saveState();
        updateVetTimer();
      }

      function modifyStat(stat, amount) {
        const prev = state[stat];
        state[stat] = clamp(state[stat] + amount, MIN_STAT, MAX_STAT);
        if (stat === "health" && prev > 20 && state.health <= 20) {
          showToast("‚ö†Ô∏è", `${getName()} necesita atenci√≥n urgente.`);
        }
      }

      function handleAction(actionKey) {
        const action = actions[actionKey];
        if (!action) return;

        if (actionKey === "vet" && state.vetCooldown > 0) {
          const seconds = Math.ceil(state.vetCooldown / 1000);
          showToast("‚è≥", `A√∫n faltan ${seconds}s para la pr√≥xima visita.`);
          return;
        }

        let effects = action.effects;
        if (typeof effects === "function") {
          effects = effects();
        }

        Object.entries(effects).forEach(([stat, value]) => modifyStat(stat, value));
        gainXp(action.xp);
        addLogEntry({ emoji: action.emoji, message: action.text(), timestamp: Date.now() });

        if (action.cooldown) {
          state.vetCooldown = action.cooldown;
          updateVetTimer();
        }

        if (!state.accessoriesUnlocked && state.level >= 3) {
          state.accessoriesUnlocked = true;
          toggleAccessory(true);
          pushLog(`${getName()} desbloquea su primer accesorio exclusivo.`, "üåü");
        }

        const mood = getMood();
        cat.dataset.mood = mood.key;
        showToast(action.emoji, action.text());
        updateUI();
        saveState();
        wanderCat(true);
      }

      function gainXp(amount) {
        state.xp += amount;
        const levelThreshold = state.level * 120;
        if (state.xp >= levelThreshold) {
          state.xp -= levelThreshold;
          state.level += 1;
          pushLog(`${getName()} sube al nivel ${state.level}.`, "üèÖ");
          showToast("üèÖ", `${getName()} alcanza el nivel ${state.level}.`);
        }
      }

      function getMood() {
        const avg = (state.hunger + state.energy + state.fun + state.clean + state.health) / 5;
        if (avg > 80) return { key: "feliz", label: "‚ú® Feliz" };
        if (avg > 60) return { key: "contento", label: "üò∫ Contento" };
        if (avg > 40) return { key: "neutro", label: "üòê Pensativo" };
        if (avg > 20) return { key: "triste", label: "ü•∫ Trist√≥n" };
        return { key: "enfadado", label: "üòæ Enfadado" };
      }

      function updateUI() {
        updateStat(hungerBar, hungerValue, state.hunger);
        updateStat(energyBar, energyValue, state.energy);
        updateStat(funBar, funValue, state.fun);
        updateStat(cleanBar, cleanValue, state.clean);
        updateStat(healthBar, healthValue, state.health);
        updateXP();

        const mood = getMood();
        moodLabel.textContent = mood.label;
        cat.dataset.mood = mood.key;
        updateCatFace(mood.key);
        levelLabel.textContent = state.level;
        document.title = `${getName()} ¬∑ Nivel ${state.level} | Catagotchi`;
      }

      function updateStat(bar, valueLabel, statValue) {
        bar.style.setProperty("--value", `${statValue}%`);
        bar.style.width = `${statValue}%`;
        valueLabel.textContent = `${Math.round(statValue)}%`;
        if (statValue < 30) {
          valueLabel.style.color = "#ff4770";
        } else if (statValue > 70) {
          valueLabel.style.color = "#2eab6f";
        } else {
          valueLabel.style.color = "inherit";
        }
      }

      function updateXP() {
        const levelThreshold = state.level * 120;
        const xpPercent = Math.min(100, (state.xp / levelThreshold) * 100);
        xpBar.style.setProperty("--value", `${xpPercent}%`);
        xpBar.style.width = `${xpPercent}%`;
      }

      function updateCatFace(moodKey) {
        const mouth = document.getElementById("mouth");
        const pupils = document.querySelectorAll(".pupil");
        switch (moodKey) {
          case "feliz":
            mouth.setAttribute("d", "M140 190 Q160 215 180 190");
            pupils.forEach((p) => p.setAttribute("cy", "158"));
            catWanderer.style.setProperty("--scale", "1.05");
            catWanderer.style.setProperty("--bob-speed", "2.4s");
            catWanderer.style.setProperty("--shadow-opacity", "0.5");
            break;
          case "contento":
            mouth.setAttribute("d", "M145 190 Q160 200 175 190");
            pupils.forEach((p) => p.setAttribute("cy", "160"));
            catWanderer.style.setProperty("--scale", "1");
            catWanderer.style.setProperty("--bob-speed", "2.8s");
            catWanderer.style.setProperty("--shadow-opacity", "0.45");
            break;
          case "neutro":
            mouth.setAttribute("d", "M145 188 Q160 188 175 188");
            pupils.forEach((p) => p.setAttribute("cy", "162"));
            catWanderer.style.setProperty("--scale", "0.98");
            catWanderer.style.setProperty("--bob-speed", "3.2s");
            catWanderer.style.setProperty("--shadow-opacity", "0.4");
            break;
          case "triste":
            mouth.setAttribute("d", "M145 192 Q160 178 175 192");
            pupils.forEach((p) => p.setAttribute("cy", "166"));
            catWanderer.style.setProperty("--scale", "0.96");
            catWanderer.style.setProperty("--bob-speed", "3.6s");
            catWanderer.style.setProperty("--shadow-opacity", "0.35");
            break;
          default:
            mouth.setAttribute("d", "M138 192 Q160 170 182 192");
            pupils.forEach((p) => p.setAttribute("cy", "170"));
            catWanderer.style.setProperty("--scale", "0.94");
            catWanderer.style.setProperty("--bob-speed", "3.8s");
            catWanderer.style.setProperty("--shadow-opacity", "0.32");
        }
      }

      function addLogEntry(entry) {
        const element = logEntryTemplate.content.cloneNode(true);
        const timeElement = element.querySelector(".log-time");
        const textElement = element.querySelector(".log-text");
        const date = new Date(entry.timestamp || Date.now());
        const time = date.toLocaleTimeString("es-ES", { hour: "2-digit", minute: "2-digit" });
        timeElement.textContent = `${entry.emoji} ${time}`;
        textElement.textContent = entry.message;
        log.prepend(element);
        state.history.push(entry);
        state.history = state.history.slice(-40);
      }

      function pushLog(message, emoji = "‚ú®") {
        const entry = { emoji, message, timestamp: Date.now() };
        addLogEntry(entry);
        saveState();
      }

      function showToast(emoji, message) {
        toastEmoji.textContent = emoji;
        toastMessage.textContent = message;
        toast.classList.add("show");
        clearTimeout(showToast.timeoutId);
        showToast.timeoutId = setTimeout(() => {
          toast.classList.remove("show");
        }, 3200);
      }

      function randomSurpriseEffects() {
        const outcomes = [
          { hunger: +12, fun: +18, clean: -6, energy: -4 },
          { fun: +24, health: +6 },
          { energy: +14, fun: +10 },
          { health: +12, clean: +8 },
          { hunger: +16, fun: -4 },
        ];
        return outcomes[Math.floor(Math.random() * outcomes.length)];
      }

      function clamp(value, min, max) {
        return Math.min(Math.max(value, min), max);
      }

      function updateVetTimer() {
        if (state.vetCooldown <= 0) {
          vetTimer.textContent = "listo";
          return;
        }
        const minutes = Math.floor(state.vetCooldown / 60000);
        const seconds = Math.floor((state.vetCooldown % 60000) / 1000);
        vetTimer.textContent = `${String(minutes).padStart(2, "0")}:${String(seconds).padStart(2, "0")}`;
      }

      function toggleAccessory(show) {
        const accessory = document.getElementById("accessory");
        accessory.style.opacity = show ? 1 : 0;
      }

      function toggleDayMode() {
        state.dayMode = state.dayMode === "day" ? "night" : "day";
        updateDayMode();
        saveState();
        pushLog(`El entorno cambia a modo ${state.dayMode === "day" ? "d√≠a" : "noche"}.`, "üåó");
      }

      function updateDayMode() {
        document.body.dataset.mode = state.dayMode;
        if (state.dayMode === "day") {
          document.documentElement.style.setProperty(
            "--bg-primary",
            "radial-gradient(circle at top, #ffe3f1 0%, #ffb7d5 36%, #ff86c6 70%, #f564a5 100%)"
          );
          dayEmoji.textContent = "üåû";
          dayLabel.textContent = "Parque soleado";
          degradeRates = { ...baseDegradeRates };
        } else {
          document.documentElement.style.setProperty(
            "--bg-primary",
            "radial-gradient(circle at top, #2b1b68 0%, #1d0f51 42%, #10063a 75%, #040019 100%)"
          );
          dayEmoji.textContent = "üåô";
          dayLabel.textContent = "Noche estrellada";
          degradeRates = { ...baseDegradeRates, energy: -1.4 };
        }
      }

      function getName() {
        return state.name || "Pixel";
      }

      function startCatWander() {
        if (wanderIntervalId) clearInterval(wanderIntervalId);
        wanderIntervalId = setInterval(() => wanderCat(), 4200);
        wanderCat(true);
      }

      function wanderCat(force = false) {
        if (!catScene || !catWanderer) return;
        const sceneWidth = catScene.clientWidth;
        const catWidth = catWanderer.offsetWidth || 1;
        const maxOffset = (sceneWidth - catWidth) / 2 - 12;
        if (maxOffset <= 0) return;
        let newX = (Math.random() * 2 - 1) * maxOffset;
        const delta = Math.abs(newX - catMotion.x);
        if (!force && delta < sceneWidth * 0.1) {
          newX = Math.sign(newX || 1) * Math.min(maxOffset, Math.abs(newX) + sceneWidth * 0.18);
        }
        const newY = -Math.random() * 18;
        const direction = newX < catMotion.x ? -1 : 1;
        catMotion.x = newX;
        catMotion.y = newY;
        catWanderer.style.setProperty("--x", `${newX}px`);
        catWanderer.style.setProperty("--y", `${newY}px`);
        catWanderer.style.setProperty("--flip", direction === -1 ? "-1" : "1");
      }

      window.addEventListener("visibilitychange", () => {
        state.lastTick = Date.now();
      });

      window.addEventListener("beforeunload", saveState);
    </script>
  </body>
</html>
